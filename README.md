# Техническое задание

# Система управления новостями

Разработать RESTful web-service, реализующей функционал для работы с системой управления новостями.

## Основные сущности
- news (новость) содержит поля: id, time, title, text и comments (list).
- comment содержит поля: id, time, text, username и news_id.

## Требования
1. Использовать Spring Boot 3.x, Java 17, Gradle и PostgreSQL.
2. Разработать API согласно подходам REST (UI не надо):
    - CRUD для работы с новостью
    - CRUD для работы с комментарием
    - просмотр списка новостей (с пагинацией)
    - просмотр новости с комментариями относящимися к ней (с пагинацией)
        - /news
        - /news/{newsId}
        - /news/{newsId}/comments
        - /news/{newsId}/comments/{commentsId}
    - полнотекстовый поиск по различным параметрам (для новостей и комментариев)
      Для потенциально объемных запросов реализовать постраничность
3. Разместить проект в любом из публичных git-репозиториев (Bitbucket, github, gitlab)
4. Код должен быть легко читаемый и понятный, с использованием паттернов проектирования
5. Реализовать на основе Spring @Profile (e.g. test & prod) подключение к базам данных.
6. Подключить liquibase:
    - при запуске сервиса накатываются скрипты на рабочую БД (генерируются необходимые таблицы из одного файла и наполняются таблицы данными из другого файла, 20 новостей и 10 комментариев, связанных с каждой новостью)
    - при запуске тестов должен подхватываться скрипт по генерации необходимых таблиц + накатить данные по заполнению таблиц (третий файл)
7. Создать реализацию кэша, для хранения сущностей. Реализовать два алгоритма LRU и LFU. Алгоритм и максимальный размер коллекции должны читаться из файла application.yml. Алгоритм работы с кешем:
    - GET - ищем в кеше и если там данных нет, то достаем объект из dao, сохраняем в кеш и возвращаем
    - POST - сохраняем в dao и потом сохраняем в кеше
    - DELETE - удаляем из dao и потом удаляем в кеша
    - PUT - обновление/вставка в dao и потом обновление/вставка в кеше.
8. Весь код должен быть покрыт юнит-тестами (80%) (сервисный слой – 100%)
9. Реализовать логирование запрос-ответ в аспектном стиле (для слоя Controlles), а также логирование по уровням в отдельных слоях приложения, используя logback
10. Предусмотреть обработку исключений и интерпретацию их согласно REST (см. [Exception Handling in Spring MVC](https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc))
11. Все настройки должны быть вынесены в *.yml
12. Код должен быть документирован @JavaDoc, а назначение приложения и его интерфейс и настройки должны быть описаны в README.md файле
13. Использовать Spring REST Docs или другие средства автоматического документирования (например asciidoctor [Asciidoctor Gradle Plugin](https://asciidoctor.org/docs/asciidoctor-gradle-plugin/) и т.д) и/или Swagger (OpenAPI 3.0)
14. Использовать testcontainers в тестах на persistence layer (для БД)
15. Написать интеграционные тесты
16. Использовать WireMock в тестах для слоя clients (разбиение на микросервисы)
17. Использовать Docker (написать Dockerfile – для spring boot приложения, docker-compose.yml для поднятия БД и приложения в контейнерах и настроить взаимодействие между ними)
18. *Подключить кэш провайдер Redis (в docker) (в случае реализации, использовать @Profile для переключения между LRU/LFU и Redis)
19. *Spring Security:
- API для регистрации пользователей с ролями admin/journalist/subscriber
- Администратор (role admin) может производить CRUD-операции со всеми сущностями
- Журналист (role journalist) может добавлять и изменять/удалять только свои новости
- Подписчик (role subscriber) может добавлять и изменять/удалять только свои комментарии
- Незарегистрированные пользователи могут только просматривать новости и комментарии
- Создать отдельный микросервис с реляционной базой (postgreSQL) хранящей
информацию о пользователях/ролях. Из главного микросервиса (отвечающего за
новости) запрашивать эту информацию по  REST с использованием spring-cloud-
feign-client.
20.	*Настроить Spring Cloud Config (вынести в отдельный сервис и настроить разрабатываемый сервис на получение их в зависимости от профиля)
21.	*Реализацию логирования п.9 и обработку исключений п.10 вынести в отдельные
         spring-boot-starter-ы.
22.	**Сущности веб интерфейса (DTO) должны генерироваться при сборке проекта из .proto файлов (см. https://github.com/google/protobuf-gradle-plugin)

“*” – необходимо минимум выполнить два задания со звёздочкой, больше заданий будет существенным плюсом. К этим пунктам лучше приступать после качественного решения базовых задач с применением принципов SOLID, декларативных подходов, оптимальных алгоритмов.


## Детали реализации и комментарии

* создано 4 микросервиса
  * сервис управления новостями - __news__
  * сервис управления комментариями - __comment__  
  * сервис управления аутентификацией и авторизаций - __auth__
  * главный сервис, точка входа в приложение - __gateway__
* взаимодействие между микросервисами реализовано с использованием spring-cloud
* перед запуском проекта необходимо развернуть локальные библиотеки:
   * _by.clevertec:dto-box_ (Менеджер DTO)
   * _by.clevertec:spring-boot-exception-handler-starter_ (Стартер обработки ошибок)
   * _by.clevertec:spring-boot-logger-aspect-starter_ (Стартер логирования)
* запуск проекта осуществляется в докере, для запуска используется docker-compose.yaml надпапки проекта clevertec-news-management-system
* проект документирован по средствам Swagger open api
* точка входа в api проекта http://localhost:8000/documentation
* для стабильной работы проекта, в целях балансировки нагрузки, настроены тайминги ответов сервисов и circuitbreaker
* readme-файлы по каждому сервису находятся внутри соответствующих директорий

## Запуск проекта

* скачайте проект с gitHub:
  * https://github.com/NortinPowers/clevertec-news-management-system.git
* для запуска запустите скрипт в терминале:
  * ```./init.sh```
* или последовательно выполните следующие команды запуска элементов проекта в терминале:
  * _by.clevertec:dto-box_
    * ```cd dto-box```
    * ```./gradlew build -x test```
  * _by.clevertec:spring-boot-exception-handler-starter_
    * ```cd ../spring-boot-exception-handler-starter```
    * ```./gradlew build -x test```
  * _by.clevertec:spring-boot-logger-aspect-starter_
    * ```cd ../spring-boot-logger-aspect-starter```
    * ```./gradlew build -x test```
  * _news_
    * ```cd ../news```
    * ```./gradlew build -x test``` 
  * _comment_
    * ```cd ../comment```
    * ```./gradlew build -x test``` 
  * _auth_
    * ```cd ../auth```
    * ```./gradlew build -x test```  
  * _gateway_
    * ```cd ../gateway```
    * ```./gradlew build -x test``` 
* осуществите развертывание проекта выполнив команду в терминале:
  * ```cd ..```
  * ```docker-compose up```
* для входа используйте точку входа в api проекта - http://localhost:8000/documentation
